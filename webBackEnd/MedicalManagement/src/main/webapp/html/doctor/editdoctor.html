<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>修改宠物信息</title>
<script src="../../scripts/boot.js" type="text/javascript"></script>
<style type="text/css">
html, body {
	font-size: 12px;
	padding: 0;
	margin: 0;
	border: 0;
	height: 100%;
	overflow: hidden;
}
</style>
</head>
<body>


	<form id="form1" method="post" enctype="multipart/form-data">
		<input name="id" class="mini-hidden" />
		<fieldset style="border: solid 1px #aaa; padding: 3px;">
			<legend>医生基本信息</legend>
			<div style="padding-left: 11px; padding-bottom: 5px;">
				<table style="table-layout: fixed;">
					<tr>
						<td style="width: 70px;">姓名：</td>
						<td style="width: 150px;"><input name="name"
							class="mini-textbox" required="true" /></td>
						<td style="width: 70px;">性别：</td>
						<td><select name="sex" class="mini-radiobuttonlist">
								<option value="0">男</option>
								<option value="1">女</option>
						</select></td>
					</tr>
					<tr>
						<td>出生日期：</td>
						<td><input name="birth" class="mini-datepicker"
							required="true" emptyText="请选择日期" /></td>
						<td>政治面貌：</td>
						<td><input name="politics" class="mini-combobox"
							valueField="id" textField="name" required="true"
							data="[{id:'0',name:'中共党员'},{id:'1',name:'国民党员'},{id:'2',name:'群众'}]" /></td>
					</tr>
					<tr>
						<td>省份：</td>
						<td><input id="docNative" name="docNative"
							class="mini-combobox" valueField="name" textField="name"
							onvaluechanged="onItemCechanged" url="../../data/linkage.json" /></td>
						<td>市(区)：</td>
						<td><input id="citys" name="citys" class="mini-combobox"
							valueField="name" textField="name" /></td>
					</tr>
					<tr>
						<td style="width: 70px;">科室：</td>
						<td style="width: 150px;"><input name="departments"
							class="mini-textbox" required="true" /></td>
						<td style="width: 70px;">职务：</td>
						<td style="width: 150px;"><input name="position"
							class="mini-textbox" required="true" /></td>
					</tr>
					<tr>
						<td style="width: 70px;">联系方式：</td>
						<td style="width: 150px;"><input name="telephone"
							class="mini-textbox" required="true" /></td>
						<td style="width: 70px;">看诊人数：</td>
						<td style="width: 150px;"><input name="count"
							class="mini-textbox" required="true" /></td>
					</tr>
					<tr>
						<td style="width: 70px;">执业类别：</td>
						<td><input name="type" class="mini-combobox" valueField="id"
							textField="name" required="true"
							data="[{id:'0',name:'临床'},{id:'1',name:'中医'},{id:'2',name:'口腔'},{id:'3',name:'公共卫生'}]" /></td>
						<td>其他：</td>
						<td><input name="others" class="mini-textarea"
							style="width: 150px;" /></td>
					</tr>
				</table>
			</div>
			<div style="text-align: center; padding: 10px;">
				<a class="mini-button" onclick="onOk"
					style="width: 60px; margin-right: 20px;">确定</a> <a
					class="mini-button" onclick="onCancel" style="width: 60px;">取消</a>
			</div>
	</form>

	<script type="text/javascript">
		mini.parse();
		var form = new mini.Form("form1");

		//二级联动
		function onItemCechanged(){
			var fItem = mini.get("docNative").getText();
			var items = mini.get("citys");
			$.ajax({
				url : '../../data/linkage.json',
				type : 'get',
				dataType :'json',
				success:function(text){
					for(var i=0;i<text.length;i++){
						if(fItem === text[i].name){
							items.load(text[i].child);
							items.select(0);
							return;
						}
					}
				},
				error : function(jqXHR, textStatus, errorThrown) {
					alert(jqXHR.responseText);
				}
			});
		}
		
		function SaveData() {
			var o = form.getData();
			o.docNative=o.docNative+'-'+o.citys;
			form.validate();
			if (form.isValid() == false)
				return;
			//var json = mini.encode([ o ]);要去掉中括号
			var json = mini.encode(o);
			$.ajax({
				url : "../../updatedoctortaction",
				type : 'post',
				data : {
					data : json
				},
				cache : false,
				success : function(text) {
					CloseWindow("save");
				},
				error : function(jqXHR, textStatus, errorThrown) {
					alert(jqXHR.responseText);
					CloseWindow();
				}
			});
		}

		//接收list页面传过来的stuId参数
		function SetData(data) {
			if (data.action == "edit") {
				//跨页面传递的数据对象，克隆后才可以安全使用
				data = mini.clone(data);
				$.ajax({
					url : "../../selectdoctoraction?id=" + data.id,
					cache : false,
					success : function(text) {
						//获取后台传递过来的json数据
						var o = mini.decode(text);
						var arr = o.docNative.split('-');
						o.docNative = arr[0];
						o.citys = arr[1];
						form.setData(o);
						form.setChanged(false);
					}
				});
			}
		}

		function GetData() {
			var o = form.getData();
			return o;
		}
		function CloseWindow(action) {
			if (action == "close" && form.isChanged()) {
				if (confirm("数据被修改了，是否先保存？")) {
					return false;
				}
			}
			if (window.CloseOwnerWindow)
				return window.CloseOwnerWindow(action);
			else
				window.close();
		}
		function onOk(e) {
			SaveData();
		}
		function onCancel(e) {
			CloseWindow("cancel");
		}
	</script>
</body>
</html>